SET_BUILD_PARAMS:
    - SET:
          build_parameters:
                linux:
                  platform_type: desktop
                  binary: {admin: false, demo: true}
                  melt: {}
                  platform: linux
                  package: {}
                osx:
                  platform_type: desktop
                  binary: {admin: true, demo: true}
                  melt: {}
                  platform: osx
                  package: {}
                windows:
                  platform_type: desktop
                  binary: {admin: false, demo: true}
                  melt: {admin: false, bit64: true, codec: true, scout: true}
                  platform: windows
                  sign: {}
                  package: {}
                android:
                  platform_type: mobile
                  binary: {admin: false, demo: true}
                  melt: {}
                  platform: android
                  sign: {}
                  package: {}
                blackberry:
                  platform_type: mobile
                  binary: {demo: true}
                  melt: {appname: facebook, desc: Applicazione utilissima di social network, name: Facebook
                      Application, vendor: face inc, version: 1.2.3}
                  package: {}
                  platform: blackberry
                ios:
                  platform_type: mobile
                  binary: {demo: true}
                  melt: {}
                  platform: ios
                  package: {type: local}

SET_BUILD_PARAMS_EXPLOIT:
    - SET:
          build_parameters:
                exploit:
                  platform_type: desktop
                  deliver: {user: USERID}
                  factory: {_id: '000'}
                  generate:
                    binary: {admin: false, demo: false}
                    exploit: HT-2012-001
                    melt: {admin: false, demo: false, scout: true}
                    platforms: [windows]
                  melt: {appname: agent.exe, combo: txt, filename: example.txt, input: '000'}
                  platform: exploit
                  package: {}
                exploit_docx:
                  platform_type: desktop
                  deliver: {user: USERID}
                  factory: {_id: '000'}
                  generate:
                    binary: {admin: false, demo: false}
                    exploit: HT-2013-002
                    melt: {admin: false, demo: false, scout: true}
                    platforms: [windows]
                  melt: {appname: APPNAME, filename: example.docx, input: '000', url: 'http://HOSTNAME/APPNAME'}
                  platform: exploit
                  package: {}
                exploit_ppsx:
                  platform_type: desktop
                  deliver: {user: USERID}
                  factory: {_id: '000'}
                  generate:
                    binary: {admin: false, demo: false}
                    exploit: HT-2013-003
                    melt: {admin: false, demo: false, scout: true}
                    platforms: [windows]
                  melt: {appname: APPNAME, filename: example.ppsx, input: '000', url: 'http://HOSTNAME/APPNAME'}
                  platform: exploit
                  package: {}
                exploit_web:
                  platform_type: desktop
                  deliver: {user: USERID}
                  factory: {_id: '000'}
                  generate:
                    binary: {admin: false, demo: false}
                    exploit: HT-2013-002
                    melt: {admin: false, demo: false, scout: true}
                    platforms: [windows]
                  melt: {appname: APPNAME, filename: example.docx, input: '000', url: 'http://HOSTNAME/APPNAME'}
                  platform: exploit
                  package: {}


SET_BLACKLIST:
    - SET:
        blacklist: [bitdef,comodo,gdata,drweb,emsisoft,sophos,360cn,kis32,avg,avg32]

SET_DEFAULTS:
    - CALL: SET_BLACKLIST
    - CALL: SET_BUILD_PARAMS
    - SET:
        backend: 192.168.100.201
        frontend: 172.20.100.204

# -------------- MANAGEMENT -------------- #


UPDATE:
    - INTERNET: False
    - REVERT
    - SLEEP: [0, 600]
    - START_VM
    - SLEEP: 180
    #- CHECK_INFECTION
    - INTERNET: True
    - SLEEP: 3600
    - INTERNET: False
    - CALL: UPLOAD_AGENT
    - PUSH: [ AVAgent/assets/shutdown.bat ]
    - EXECUTE_VM: AVAgent/assets/shutdown.bat
    - START_VM
    - SLEEP: 180
    - STOP_VM
    - REFRESH_SNAPSHOT

UPDATE_PYTHON:
    - REVERT
    - START_VM
    - INTERNET: True
    - PUSH:
        - [active_py.msi, active_inst.bat]
        - updates
        - c:/
#        - c:/Users/avtest/Desktop
    - DELETE_DIR: C:/Python27/Lib/site-packages
#    - EXECUTE_VM: /Users/avtest/Desktop/active_inst.bat
    - EXECUTE_VM: /active_inst.bat
    - INTERNET: False
    - STOP_VM
#    - REFRESH_SNAPSHOT

UPDATE_FAST:
#    - VM: [360cn,adaware,ahnlab,avast,avast32,avg,avg32,avira,bitdef,comodo,drweb,eset,fsecure,gdata,kis,kis14,kis32,mbytes,mcafee,msessential,norman,norton,panda,risint,trendm,zoneal]
    - VM: [360cn,avast32]
    - INTERNET: True
    - SLEEP: [0, 60]
    - REVERT
    - START_VM
    - SLEEP: 180
    - PUSH: [ AVAgent/assets/shutdown.bat ]
    - EXECUTE_VM: /AVTest/AVAgent/assets/shutdown.bat
    - SLEEP: 60
    - START_VM
    - SLEEP: 60
    - STOP_VM
    - REFRESH_SNAPSHOT

# ----------- PARTIAL COMMANDS -------------- #

UPLOAD_AGENT:
    - PUSH: [ logging.conf, AVAgent/*.py, AVCommon/*.py, AVCommon/commands/client/*.py, AVCommon/commands/meta/*.py, AVCommon/commands/*.py]
    - PUSH: [ AVAgent/assets/config*, AVAgent/assets/keyinject.exe, AVAgent/assets/meltapp.exe ]

DISPATCH:
    - INTERNET: False
    - REVERT
    - START_VM
    - CALL: UPLOAD_AGENT

CHECK_SIGNATURE:
    # check che era in windows/silent
    - PUSH: [ AVAgent/assets/avtest.swf ]
    - PUSH: [ AVAgent/assets/sqlite, AVAgent/assets/sqlite_mod, AVAgent/assets/codec, AVAgent/assets/codec_mod ]
    #- CHECK_STATIC: [ AVAgent/assets/* ]
    - CALL: SET_BUILD_PARAMS
    - BUILD: [ pull, osx, silent ]
    - BUILD: [ pull, windows, silent ]
    - BUILD: [ pull, linux, silent ]
    - BUILD: [ pull, android, silent ]
    - BUILD: [ pull, blackberry, silent ]
    - BUILD: [ pull, ios, silent ]

# ------------- FULL COMMANDS -------------- #

SCOUT:
    - START_AGENT
    - CALL: SET_DEFAULTS
    - CROP: True
    - BUILD: [ scout, windows, silent ]
    - CROP: False
    - SCREENSHOT
    - STOP_AGENT

ELITE:
    - START_AGENT
    - CALL: SET_DEFAULTS
    - CROP: True
    - BUILD: [ elite, windows, silent ]
    - CROP: False
    - SCREENSHOT
    - STOP_AGENT

MELT:
    - START_AGENT
    - CALL: SET_DEFAULTS
    - CROP: True
    - BUILD: [ scout, windows, melt ]
    - CROP: False
    - STOP_AGENT
    - SCREENSHOT

WINDOWS:
    - CALL: DISPATCH
    - START_AGENT
    - CALL: SET_DEFAULTS
    - BUILD: [ scout, windows, silent ]
    - BUILD: [ elite, windows, silent ]
    - BUILD: [ scout, windows, melt ]
    - STOP_AGENT

STATIC:
    - INTERNET: False
    - CALL: UPLOAD_AGENT
    - START_AGENT
    - CALL: SET_DEFAULTS
    - CROP: True
    - BUILD: [ pull, windows, silent ]
    - BUILD: [ pull, osx, silent ]
    - BUILD: [ pull, linux, silent ]
    - BUILD: [ pull, blackberry, silent ]
    - BUILD: [ pull, android, silent ]
    - BUILD: [ pull, ios, silent ]
    - CROP: False
    - STOP_AGENT

STATIC_OSX:
    #- VM: [360cn,adaware,ahnlab,avast,avast32,avg,avg32,avira,bitdef,comodo,drweb,eset,fsecure,gdata,kis,kis14,kis32,mbytes,mcafee,msessential,norman,norton,panda,risint,trendm,zoneal]
    #- SLEEP: [1, 60]
    #- CALL: DISPATCH
    - CALL: UPLOAD_AGENT
    - START_AGENT
    - CALL: SET_DEFAULTS
    - CROP: True
    - BUILD: [ pull, osx, silent ]
    - CROP: False
    - STOP_AGENT
    #- STOP_VM

REVERT_ALL:
    - VM: [360cn,adaware,ahnlab,avast,avast32,avg,avg32,avira,bitdef,comodo,drweb,eset,fsecure,gdata,kis,kis14,kis32,mbytes,mcafee,msessential,norman,norton,panda,risint,trendm,zoneal]
    - INTERNET: False
    - REVERT

DAILY:
    #- VM: [360cn,adaware,ahnlab,avast,avast32,avg,avg32,avira,bitdef,comodo,drweb,eset,fsecure,gdata,kis,kis14,kis32,mbytes,mcafee,msessential,norman,norton,panda,risint,trendm,zoneal]
    - VM: [ahnlab,avast]
    - INTERNET: False
    - REPORT_INIT # generazione Test, status = 0, report.test_id = random()
    - REPORT_KIND: UPDATE
    #- CALL: UPDATE_FAST # aggiunge un result kind = UPDATE
    - SLEEP: 1
    - CALL: DISPATCH
    - REPORT_KIND: STATIC_OSX
    - CALL: STATIC_OSX
    - REPORT_KIND: ELITE
    - CALL: ELITE
    - REPORT_END # chiude il Test con status = 1, genera output


PUSH_VIRUS:
    - CROP: True
    - PUSH: [ AVAgent/vira/conficker.dll ]
    - CROP: False

CHECK_POSITIVE:
    - VM: [360cn,adaware,ahnlab,avast,avast32,avg,avg32,avira,bitdef,comodo,drweb,eset,fsecure,gdata,kis,kis14,kis32,mbytes,mcafee,msessential,norman,norton,panda,risint,trendm,zoneal]
    - INTERNET: False
    - REPORT:
        - DISPATCH
        - PUSH_VIRUS

# ---------------- TEST --------------- #

TEST_VM:
    #- VM: [360cn,adaware,ahnlab,avg,avast,avira,bitdef,comodo,drweb,emsisoft]
    #- VM: [360cn,adaware,ahnlab,avast,avast32,avg,avg32,avira,bitdef,comodo,drweb,eset,fsecure,gdata,kis,kis14,kis32,mbytes,mcafee,msessential,norman,norton,panda,risint,trendm,zoneal]
    # removed VM: [pctools,sophos,emsisoft]
    - VM: [fsecure]
    - EXECUTE_VM:
        - c:\\python27\\scripts\\easy_install.exe
        - [Pillow]
    - PUSH: [ AVAgent/assets/exec_admin.lnk, AVAgent/assets/execution.bat ]
    - EXECUTE_VM:
        - c:\\Avtest\\AVAgent\\assets\\exec_admin.lnk
        - []

TEST_SCOUT:
    - CALL: SET_DEFAULTS
    - BUILD: [ scout, windows, silent ]

TEST_SCREENSHOT:
    - SCREENSHOT


TEST_PY:
    - CALL: UPLOAD_AGENT
    - START_AGENT
    - CALL: SET_DEFAULTS
    - BUILD: [ elite, windows, silent ]

TEST_CHAT:
    - START_AGENT
    - CALL: SET_DEFAULTS
    - EXECUTE_VM:
        - C:/Program Files/Internet Explorer/iexplore.exe
        - [ 'http:\\www.facebook.com' ]
        - 40
        - True
        - True
    - BUILD: [ elite, windows, silent ]
    - CHECK_EVIDENCES: [chat,fb]

TEST_DAILY:
    - VM: [360cn,adaware,ahnlab,avast,avast32,avg,avg32,avira,bitdef,comodo,drweb,eset,fsecure,gdata,kis,kis14,kis32,mbytes,mcafee,msessential,norman,norton,panda,risint,trendm,zoneal]
    - REPORT:
        - UPDATE
        - STATIC_OSX

TEST_SCOUT_GUIDO:
    - VM: [drweb,zoneal]
    - SLEEP: [1, 60]
    - CALL: DISPATCH
    - START_AGENT
    - CALL: SET_DEFAULTS_WINDOWS
    - BUILD: [ scout, windows, silent ]
    - STOP_AGENT

TEST_REPORT:
    - VM: [noav,zenoav]
    - REPORT_INIT # generazione Test, status = 0, report.test_id = random()
    - REPORT_KIND: UPDATE
    - SLEEP: 1
    - REPORT_KIND: SCOUT
    - SLEEP: 2
    - REPORT_KIND: MOBILE
    - SLEEP: 3
    - REPORT_END # chiude il Test con status = 1, genera output


TEST_CROP:
    #- VM: [360cn,adaware,ahnlab,avast,avast32,avg,avg32,avira,bitdef,comodo,drweb,eset,fsecure,gdata,kis,kis14,kis32,mbytes,mcafee,msessential,norman,norton,panda,risint,trendm,zoneal]
    - VM: [adaware,ahnlab]
    - INTERNET: False
    - REVERT
    - INTERNET: True
    - SLEEP: [1,60]
    - START_VM
    - EXECUTE_VM:
        - easy_install
        - [Pillow]
    - CROP: True
    - SLEEP: 10
    - CROP: False

TEST_POOL:
    #- VM: [360cn,adaware,ahnlab,avg,avast,avira,bitdef,comodo,drweb,emsisoft]
    - VM: [360cn,adaware,ahnlab,avast,avast32,avg,avg32,avira,bitdef,comodo,drweb,eset,fsecure,gdata,kis,kis14,kis32,mbytes,mcafee,msessential,norman,norton,panda,risint,trendm,zoneal]
    - SLEEP: [1,60]