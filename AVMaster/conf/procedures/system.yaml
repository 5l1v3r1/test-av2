
# ------------- SYSTEM COMMANDS -------------- #

SYSTEM_STATIC:
    - VM_ALL
    - CALL: INIT_DISPATCH
    - START_AGENT
    - CROP: True
    - REPORT:
        - BUILD_DESKTOP
        - BUILD_MOBILE
        - BUILD_EXPLOIT
    - CROP: False
    - STOP_AGENT
    - STOP_VM

SYSTEM_STATIC_MOBILE:
    - VM_ALL: IMPORTANT
    - INTERNET: False
    - SLEEP: [0, 600]
    - CALL: INIT_DISPATCH
    - START_AGENT
    - CLEAN_EVIDENCES
    - CROP: True
    - REPORT:
        - BUILD_MOBILE
    - CROP: False
    - STOP_AGENT
    - STOP_VM

REVERT:
    - VM_ALL
    - INTERNET: False
    - SLEEP: [1, 10]
    - REVERT

SYSTEM_START:
    - VM_ALL
    - INTERNET: False
    - SLEEP: [1, 60]
    - START_VM


# ------------  #

VM_ELITE_FAST:
    - CALL: SET_DEFAULTS
    #- CROP: True
    - BUILD: [ scout, windows, silent ]
    - SLEEP: 30
    #- CROP: False
    - RELOG

    - CALL: SET_DEFAULTS
    - CROP: True
    - BUILD: [ elite_fast, windows, silent ]
    - CROP: False

    #- ON_ERROR: CONTINUE
    #- CHECK_INFECTION
    #- ON_ERROR: SKIP
    - UNINSTALL
    - RELOG

VM_MELT:
    - CALL: SET_DEFAULTS
    #- CROP: True
    - BUILD: [ scout, windows, melt ]
    #- CROP: False
    - UNINSTALL
    - SCREENSHOT
    - RELOG

VM_EXPLOIT:
    - PUSH: [ AVAgent/assets/avtest.swf, AVAgent/assets/melt*, AVAgent/assets/PMIEFuck-WinWord.dll ]
    - PUSH: [ AVAgent/assets/sqlite, AVAgent/assets/sqlite_mod, AVAgent/assets/codec, AVAgent/assets/codec_mod ]
    - CALL: SET_DEFAULTS
    - CALL: SET_BUILD_PARAMS_EXPLOIT
    - BUILD: [ pull, exploit_docx, melt ]
    - BUILD: [ scout, exploit, melt ]
    - UNINSTALL
    - RELOG

VM_STATIC:
    - CROP: True
    - ON_ERROR: CONTINUE
    - CALL: BUILD_DESKTOP
    - CALL: BUILD_MOBILE
    - CALL: BUILD_EXPLOIT
    - CROP: False
    - ON_ERROR: SKIP

SYSTEM_DAILY:
    - VM_ALL
    - ON_ERROR: SKIP
    - SLEEP: [10, 600]
    - CALL: INIT_DISPATCH
    - CALL: VM_CLEAN_EVIDENCES
    - SET_SERVER:
        mail_recipients: [zeno@hackingteam.com, seppia@hackingteam.com]
    - REPORT:
        - VM_STATIC: ['AV Invisibility Static', 'Static check on builds']
        - VM_ELITE_FAST: ['AV Invisibility', 'Elite']
        - VM_MELT: ['AV Invisibility', 'Melt']
        - VM_EXPLOIT: ['AV Invisibility', 'Exploit']
    - UNINSTALL
    - CALL: END_DISPATCH

SYSTEM_DAILY_POSITIVE:
    - VM_ALL
    - ON_ERROR: SKIP
    - SLEEP: [10, 600]
    - CALL: INIT_DISPATCH
    - CALL: VM_CLEAN_EVIDENCES
    - SET_SERVER:
        mail_recipients: [zeno@hackingteam.com, seppia@hackingteam.com]
    - REPORT:
        - VM_STATIC: ['AV Invisibility Static', 'Static check on builds']
        - VM_ELITE_FAST: ['AV Invisibility', 'Elite']
        - VM_MELT: ['AV Invisibility', 'Melt']
        - VM_EXPLOIT: ['AV Invisibility', 'Exploit']
        - SYS_PUSH_VIRUS: ['AVM Update', 'Positive static check', INVERT]
    - UNINSTALL
    - CALL: END_DISPATCH

# ------------  #

SYS_PUSH_VIRUS:
    #- START_VM: AV_AGENT
    - ON_ERROR: CONTINUE
    - SLEEP: 30
    - CROP: True
    - PUSH: [ AVAgent/assets/vira/conficker.dll, AVAgent/assets/vira/eicar.com ]
    - SLEEP: 30
    - CHECK_STATIC: [ AVAgent/assets/vira/conficker.dll, AVAgent/assets/vira/eicar.com ]
    - SLEEP: 10
    - CROP: False
    #- SCREENSHOT
    #- STOP_VM

SYSTEM_POSITIVE:
    - VM_ALL
    - ON_ERROR: SKIP
    - SLEEP: [10, 600]
    - START_VM
    - REPORT:
        - SYS_PUSH_VIRUS: ['AVM Update', 'Positive static check', INVERT]
    - CALL: END_DISPATCH

SYSTEM_MANUAL:
    - START_VM: AV_AGENT
    - PUSH: [ AVAgent/assets/sqlite, AVAgent/assets/sqlite_mod, AVAgent/assets/codec, AVAgent/assets/codec_mod ]
    - CALL: SET_DEFAULTS
    - CALL: SET_BUILD_PARAMS_EXPLOIT

    - BUILD: [ pull, windows, melt ]
    - BUILD: [ pull, exploit, melt ]
#    - BUILD: [ scout, windows, silent ]

# ---------------- #

VM_FUNCTIONAL_DEVICE:
    - CHECK_EVIDENCES: [device]

VM_FUNCTIONAL_CHAT_FB:
    - CHECK_EVIDENCES: [chat, program, facebook]

VM_FUNCTIONAL_ADDRESSBOOK_FB:
    - CHECK_EVIDENCES: [addressbook, program, facebook]

VM_FUNCTIONAL_CHAT_SKYPE:
    - CHECK_EVIDENCES: [chat, program, skype]

VM_FUNCTIONAL_ADDRESSBOOK_SKYPE:
    - CHECK_EVIDENCES: [addressbook, program, skype]

SYSTEM_FUNCTIONAL_FAST:
    #- START_AGENT: 172.20.20.168
    #- CALL: SET_DEFAULTS_FUNCTIONAL
    - REPORT:
        - VM_FUNCTIONAL_CHAT_FB
        - VM_FUNCTIONAL_ADDRESSBOOK_FB

SYSTEM_FUNCTIONAL:
    #- CALL: INIT_DISPATCH
    - VM: [ funie, funch, funff ]
    - REVERT
    - START_VM
    - CALL: VM_PUSH_AGENT
    - START_AGENT: 172.20.20.168
    - CALL: SET_DEFAULTS_FUNCTIONAL
    - SLEEP: [5, 60]
    - BUILD: [ pull, windows_elite, silent ]
    - EXECUTE_VM:
        - C:/AVTest/AVAgent/build/windows_elite/agent.exe
        - []
        - 40
        - True
        - True
    - SLEEP: 100
    - PUSH: [ AVAgent/assets/facebook.bat ]
    - EXECUTE_VM:
        - C:/AVTest/AVAgent/assets/facebook.bat
        - []
        - 40
        - True
        - True
    - SLEEP: 240
    - CALL: SET_MAIL
    - REPORT:
        - VM_FUNCTIONAL_DEVICE: ['Functional testing', 'Device']
        - VM_FUNCTIONAL_CHAT_FB: ['Functional testing', 'Social Chat']
        - VM_FUNCTIONAL_ADDRESSBOOK_FB: ['Functional testing', 'Social Addressbook']
        - VM_FUNCTIONAL_ADDRESSBOOK_SKYPE: ['Functional testing', 'Skype Chat']
    #- CALL: END_DISPATCH
