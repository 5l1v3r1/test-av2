# -------------- UPDATE -------------- #
# COMPLETE COMMANDS

UPDATE_SNAPSHOT:
    - VM_ALL: IMPORTANT
    - ON_ERROR: STOP
    - INTERNET: False
    - REFRESH_SNAPSHOT

UPDATE_PYTHON_7:
    - ON_ERROR: STOP
    - REVERT
    - START_VM
    - INTERNET: True
    - PUSH:
        - [active_py.msi, active_inst.bat]
        - updates
        - c:/Users/avtest/Desktop
#        - c:/Users/avtest/Desktop
    - DELETE_DIR: C:/Python27/Lib/site-packages
    - EXECUTE_VM: /Users/avtest/Desktop/active_inst.bat
#    - EXECUTE_VM: /active_inst.bat
    - INTERNET: False
    - STOP_VM
#    - REFRESH_SNAPSHOT

UPDATE_PYTHON_XP:
    - ON_ERROR: STOP
    - REVERT
    - START_VM
    - INTERNET: True
    - PUSH:
        - [active_py.msi, active_inst.bat]
        - updates
        - c:/Documents and Settings/avtest/Desktop
#        - c:/Documents and Settings/avtest/Desktop
    - DELETE_DIR: C:/Python27/Lib/site-packages
    - EXECUTE_VM: /Documents and Settings/avtest/Desktop/active_inst.bat
#    - EXECUTE_VM: /active_inst.bat
#    - INTERNET: False
#    - STOP_VM
#    - REFRESH_SNAPSHOT


UPDATE_REG:
    #- VM: [360cn,ahnlab,avast32,avg,avg32,avira,bitdef,comodo,drweb,eset,fsecure,gdata,kis,kis14,kis32,mbytes,mcafee,msessential,norman,norton,panda,risint,trendm]
    - VM: [mbytes,ahnlab]
    - ON_ERROR: STOP
    - INTERNET: False
    - REVERT
    - SLEEP: [ 1, 120 ]
    - START_VM
    - PUSH: [assets/update_reg.bat]
    - EXECUTE_VM: c:/avtest/assets/update_reg.bat
    - SLEEP: 120
    - EXECUTE_VM: c:/windows/system32/ipconfig.exe
    - DELETE_DIR: assets
    - STOP_VM
    - REFRESH_SNAPSHOT

# ---------------------------

UPD_WAIT:
    - INTERNET: True
    - SLEEP: [10, 600]
    - REVERT
    - START_VM
    - CHECK_INFECTION # questo non e' necessario, ma e' meglio assicurarsene
    - CALL: VM_PUSH_AGENT
    - PUSH: [assets/update_reg.bat]
    - INSTALL_AGENT
    - EXECUTE_VM: /AVTest/AVAgent/assets/update_system.bat # scarica gli aggiornamenti windows
    - SLEEP: 30
    - STOP_VM: 300
    - WAIT_SHUTDOWN

    - START_VM: AV_AGENT
    - CALL: SET_DEFAULTS
    - UNINSTALL
    - CLEAN_EVIDENCES
    - SLEEP: 3600 # attesa per gli update degli av
    - SCREENSHOT
    - STOP_VM: 300 # cerca di spegnere con shutdown, se non ci riesce, spegne secco
    - WAIT_SHUTDOWN

    - START_VM: AV_AGENT
    - STOP_VM
    - WAIT_SHUTDOWN

UPD_REFRESH:
    - REFRESH_SNAPSHOT

UPDATE_FULL:
    - VM_ALL
    - ON_ERROR: STOP
    - SET_SERVER:
        mail_recipients: [zeno@hackingteam.it]
    - REPORT:
        - UPD_WAIT: ['AVM Update', 'Update AV']
        - UPD_REFRESH
    - CALL: END_DISPATCH
# ---------------------------

UPD_WAIT_FAST:
    - START_VM: AV_AGENT
    - CALL: SET_DEFAULTS
    - UNINSTALL
    - CLEAN_EVIDENCES
    - SLEEP: 600 # attesa per gli update degli av
    - SCREENSHOT
    - STOP_VM: 300 # cerca di spegnere con shutdown, se non ci riesce, spegne secco
    - WAIT_SHUTDOWN

UPDATE_FAST:
    - VM_ALL
    - ON_ERROR: STOP
    - REPORT:
        - UPD_INSTALL_AGENT
        - UPD_WAIT_FAST
        - UPD_REFRESH

# ---------------------------

UPDATE_DELETE_CACHE:
    #- VM_ALL
    - VM: [zenoav, noav]
    - ON_ERROR: STOP
    - SLEEP: [0, 10]
    - REVERT
    - START_VM
    - PUSH: [ AVAgent/assets/delete_cache.bat ]
    - EXECUTE_VM: /AVTest/AVAgent/assets/delete_cache.bat
    - SLEEP: 30
    - STOP_VM: 300
    - REFRESH_SNAPSHOT
