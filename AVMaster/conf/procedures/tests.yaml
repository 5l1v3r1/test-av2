# ---------------- TEST --------------- #

TEST_VM:
    #- VM: [360cn,adaware,ahnlab,avg,avast,avira,bitdef,comodo,drweb,emsisoft]
    #- VM: [360cn,adaware,ahnlab,avast,avast32,avg,avg32,avira,bitdef,comodo,drweb,eset,fsecure,gdata,kis,kis14,kis32,mbytes,mcafee,msessential,norman,norton,panda,risint,trendm,zoneal]
    # removed VM: [pctools,sophos,emsisoft]
    - VM: [fsecure]
    - EXECUTE_VM:
        - c:\\python27\\scripts\\easy_install.exe
        - [Pillow]
    - PUSH: [ AVAgent/assets/exec_admin.lnk, AVAgent/assets/execution.bat ]
    - EXECUTE_VM:
        - c:\\Avtest\\AVAgent\\assets\\exec_admin.lnk
        - []

TEST_REFRESH:
    - REFRESH_SNAPSHOT

TEST_EMPTY:
    - VM: ['noav']
    - START_AGENT
    - CHECK_EMPTY_DIR:
        - [ '/Users/avtest/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Startup', '/Documents and Settings/avtest/Start Menu/Programs/Startup/']
        - [ desktop.ini ]
    - STOP_AGENT

TEST_EVIDENCE:
    - VM: ['funvm']
    #- CALL: INIT_DISPATCH
    - CALL: VM_PUSH_AGENT
    - START_AGENT: 172.20.20.168
    - CALL: SET_SERVERS
    - CHECK_EVIDENCES: [device]
    - CHECK_EVIDENCES: [chat,program,facebook]
    - STOP_AGENT
    - CALL: VM_GET_LOG

TEST_CLEAN:
    - VM: ['noav','kis']
    #- CALL: INIT_DISPATCH
    - START_AGENT
    - CALL: SET_SERVERS
    - CLEAN_EVIDENCES
    - STOP_AGENT
    #- CALL: END_DISPATCH

TEST_LOG:
    - VM: ['noav']
    - STOP_VM
    - START_VM
    - RELOG
    - CALL: VM_GET_LOG

TEST_CROP:
    - VM: [ noav ]
    #- CALL: INIT_DISPATCH
    - CALL: VM_PUSH_AGENT
    - START_AGENT
    - CALL: SET_DEFAULTS
    - CROP: True
    - PUSH: [ AVAgent/assets/facebook.bat ]
    - EXECUTE_VM:
        - C:/AVTest/AVAgent/assets/facebook.bat
        - []
        - 10
        - True
        - True
    - SLEEP: 10
    - CROP: False
    - STOP_AGENT

TEST_PACKER_SILENT:
    - CALL: INIT_DISPATCH
    - START_AGENT
    - CALL: SET_DEFAULTS
    - CROP: True
    - REPORT:
        - BUILD: [ pull, windows, silent ]
        - CHECK_STATIC: [ AVAgent/build/windows/agent.exe ]

        - BUILD: [ pull, windows, silent ]
        - CHECK_STATIC: [ AVAgent/build/windows/agent.exe ]

        - BUILD: [ pull, windows, silent ]
        - CHECK_STATIC: [ AVAgent/build/windows/agent.exe ]

        - BUILD: [ pull, windows, silent ]
        - CHECK_STATIC: [ AVAgent/build/windows/agent.exe ]

        - BUILD: [ pull, windows, silent ]
        - CHECK_STATIC: [ AVAgent/build/windows/agent.exe ]

        - BUILD: [ pull, windows, silent ]
        - CHECK_STATIC: [ AVAgent/build/windows/agent.exe ]

        - BUILD: [ pull, windows, silent ]
        - CHECK_STATIC: [ AVAgent/build/windows/agent.exe ]

        - BUILD: [ pull, windows, silent ]
        - CHECK_STATIC: [ AVAgent/build/windows/agent.exe ]

        - BUILD: [ pull, windows, silent ]
        - CHECK_STATIC: [ AVAgent/build/windows/agent.exe ]

        - BUILD: [ pull, windows, silent ]
        - CHECK_STATIC: [ AVAgent/build/windows/agent.exe ]
    - STOP_AGENT
    - STOP_VM

TEST_INFECTION:
    - VM: [noav]
    - ON_ERROR: STOP
    #- CALL: INIT_DISPATCH
    #- CALL: VM_PUSH_AGENT
    - START_AGENT
    - CALL: SET_DEFAULTS
    - BUILD: [ scout, windows, silent ]
    - ON_ERROR: CONTINUE
    - CHECK_INFECTION
    - UNINSTALL
    - CHECK_INFECTION

TEST_UNINSTALL:
    - VM: [noav]
    - ON_ERROR: STOP
    #- CALL: VM_PUSH_AGENT
    - START_AGENT
    - CALL: SET_SERVERS
    - ON_ERROR: SKIP
    - UNINSTALL
    - CHECK_INFECTION
    - STOP_AGENT

TEST_INSTALL:
    - VM: [noav]
    - ON_ERROR: STOP
    - CALL: VM_PUSH_AGENT
    - INSTALL_AGENT
    - RELOG

TEST_ELITE_FAST:
    - VM: [noav]
    - CALL: VM_PUSH_AGENT
    - INSTALL_AGENT
    - RELOG
    - REPORT:
        - VM_ELITE_FAST
    - UNINSTALL

TEST_RELOG:
    - VM: [noav]
    - RELOG

TEST_UPDATE:
    - VM: [trendm,gdata,drweb]
    - ON_ERROR: STOP
    - REVERT
    - START_VM
    - CHECK_INFECTION # questo non e' necessario, ma e' meglio assicurarsene
    - CALL: VM_PUSH_AGENT
    - INSTALL_AGENT
    - EXECUTE_VM: /AVTest/AVAgent/assets/update_system.bat # scarica gli aggiornamenti windows
    - STOP_VM: 300
    - WAIT_SHUTDOWN

    - START_VM
    - CALL: SET_DEFAULTS
    - UNINSTALL
    - SLEEP: 6 # attesa per gli update degli av
    - SCREENSHOT
    - STOP_VM: 300 # cerca di spegnere con shutdown, se non ci riesce, spegne secco
    - WAIT_SHUTDOWN

    - START_VM: AV_AGENT
    - STOP_VM
    - WAIT_SHUTDOWN

    - REFRESH_SNAPSHOT

TEST_SLEEP:
    - VM_ALL
    - SLEEP: [10,100]
