# ------------ FOGLIO DI STILE -------------- #

# 3 livelli: SYSTEM, VM, AGENT
# SYSTEM: // opzionale START_VM + STOP_VM
#    - INIT_
#    - END_
#    - SYSTEM_
# VM: // no START_VM, si' opzionale: START_AGENT + STOP_AGENT
#   - VM
# AGENT: // no START_VM, no START_AGENT
#   - AG_
#   - CHECK_
#   - *

# ----------- PARTIAL COMMANDS -------------- #

INIT_DISPATCH:
    - INTERNET: False
    - REVERT
    - START_VM
    - CALL: VM_PUSH_AGENT

END_DISPATCH:
    - STOP_VM

LOGOUT:
    - EXECUTE_VM:
        - /Windows/System32/logoff.exe
        - []
        - 10
        - True
        - True
    - SLEEP: 120

# -------------- VM COMMANDS -------------- #


VM_PUSH_AGENT:
    - PUSH: [ AVAgent/*.py, AVCommon/*.py, AVCommon/*.yml, AVCommon/commands/client/*.py, AVCommon/commands/meta/*.py, AVCommon/commands/*.py]
    - PUSH: [ AVAgent/assets/config*, AVAgent/assets/keyinject.exe, AVAgent/assets/meltapp.exe ]

VM_UPLOAD_SKYPE:
    - PUSH:
        - [SkypeSetup.exe]
        - updates
        - c:/Users/avtest/Desktop

VM_GET_LOG:
    - PULL:
        - ['avmonitor.log']
        - c:\\AVTest\\logs
        - logs

VM_PUSH_VIRUS:
    - START_AGENT
    - CROP: True
    - PUSH: [ AVAgent/assets/vira/conficker.dll, AVAgent/assets/vira/eicar.com ]
    - SLEEP: 30
    - CROP: False
    - CHECK_STATIC: [ AVAgent/assets/vira/conficker.dll, AVAgent/assets/vira/eicar.com ]
    - CHECK_EMPTY_DIR:
        - [ '/Users/avtest/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Startup', '/Documents and Settings/avtest/Start Menu/Programs/Startup/']
        - [ desktop.ini ]
    - STOP_AGENT

VM_PULL_WINDOWS:
    - START_AGENT
    - CALL: SET_DEFAULTS
    - BUILD: [ pull, windows, silent ]
    - BUILD: [ pull, windows, melt ]
    - STOP_AGENT

VM_SCOUT:
    - START_AGENT
    - CALL: SET_DEFAULTS
    - CROP: True
    - BUILD: [ scout, windows, silent ]
    - CROP: False
    - SCREENSHOT
    - STOP_AGENT

VM_ELITE:
    - START_AGENT
    - CALL: SET_DEFAULTS
    - CROP: True
    - BUILD: [ elite, windows, silent ]
    - SLEEP: 30
    - SCREENSHOT
    - CROP: False
    - CHECK_EMPTY_DIR:
        - [ '/Users/avtest/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Startup', '/Documents and Settings/avtest/Start Menu/Programs/Startup/']
        - [ desktop.ini ]
    - UNINSTALL
    - STOP_AGENT
    - CALL: LOGOUT

VM_MELT:
    - START_AGENT
    - CALL: SET_DEFAULTS
    - CROP: True
    - BUILD: [ scout, windows, melt ]
    - CROP: False
    - UNINSTALL
    - STOP_AGENT
    - SCREENSHOT
    - CALL: LOGOUT

VM_STATIC_WINDOWS:
    - START_AGENT
    - CROP: True
    - CALL: BUILD_WINDOWS
    - STOP_AGENT

VM_STATIC:
    - START_AGENT
    - CROP: True
    - ON_ERROR: CONTINUE
    - CALL: BUILD_DESKTOP
    - CALL: BUILD_MOBILE
    - CALL: BUILD_EXPLOIT
    - ON_ERROR: SKIP
    - STOP_AGENT

VM_CLEAN_EVIDENCES:
    - START_AGENT
    - CALL: SET_SERVERS
    - CLEAN_EVIDENCES
    - STOP_AGENT


VM_STATIC_OSX:
    #- VM: [360cn,adaware,ahnlab,avast,avast32,avg,avg32,avira,bitdef,comodo,drweb,eset,fsecure,gdata,kis,kis14,kis32,mbytes,mcafee,msessential,norman,norton,panda,risint,trendm,zoneal]
    #- SLEEP: [1, 60]
    #- CALL: INIT_DISPATCH
    - CALL: VM_PUSH_AGENT
    - START_AGENT
    - CALL: SET_DEFAULTS
    - CROP: True
    - BUILD: [ pull, osx, silent ]
    - CROP: False
    - STOP_AGENT
    #- STOP_VM

BUILD_MELT_FAST:
    - BUILD: [ pull, windows, melt ]

VM_PACKER_MELT:
    - VM: [avg, avg32]
    - CALL: INIT_DISPATCH
    #- CALL: VM_PUSH_AGENT
    - START_AGENT
    - CALL: SET_DEFAULTS
    - CROP: True
    - REPORT:
        - BUILD_MELT_FAST
        - BUILD_MELT_FAST
        - BUILD_MELT_FAST
        - BUILD_MELT_FAST
        - BUILD_MELT_FAST

        - BUILD_MELT_FAST
        - BUILD_MELT_FAST
        - BUILD_MELT_FAST
        - BUILD_MELT_FAST
        - BUILD_MELT_FAST

    - CROP: False
    - STOP_AGENT
    - STOP_VM

# ------------- SYSTEM COMMANDS -------------- #


SYSTEM_WINDOWS:
    - CALL: INIT_DISPATCH
    - START_AGENT
    - CALL: SET_DEFAULTS
    - BUILD: [ scout, windows, silent ]
    - BUILD: [ elite, windows, silent ]
    - BUILD: [ scout, windows, melt ]
    - STOP_AGENT

SYSTEM_STATIC:
    - VM_ALL
    - INTERNET: False
    - CALL: INIT_DISPATCH
    - START_AGENT
    - CROP: True
    - REPORT:
        - BUILD_DESKTOP
        - BUILD_MOBILE
        - BUILD_EXPLOIT
    - CROP: False
    - STOP_AGENT
    - STOP_VM

SYSTEM_STATIC_MOBILE:
    - VM_ALL: IMPORTANT
    - INTERNET: False
    - SLEEP: [0, 600]
    - CALL: INIT_DISPATCH
    - START_AGENT
    - CLEAN_EVIDENCES
    - CROP: True
    - REPORT:
        - BUILD_MOBILE
    - CROP: False
    - STOP_AGENT
    - STOP_VM

SYSTEM_REVERT:
    - VM_ALL
    - INTERNET: False
    - SLEEP: [1, 10]
    - REVERT

SYSTEM_START:
    - VM_ALL
    - INTERNET: False
    - SLEEP: [1, 60]
    - START_VM

SYSTEM_DAILY:
    - VM_ALL
    #- VM: [ahnlab,avast]

    - SLEEP: [1, 60]
    - CALL: INIT_DISPATCH
    #- CALL: VM_CLEAN_EVIDENCES
    - REPORT:
        - VM_STATIC
        - VM_ELITE
        - VM_MELT
    - CALL: END_DISPATCH

SYSTEM_POSITIVE:
    - VM: [360cn,adaware,ahnlab,avast,avast32,avg,avg32,avira,bitdef,comodo,drweb,eset,fsecure,gdata,kis,kis14,kis32,mbytes,mcafee,msessential,norman,norton,panda,risint,trendm,zoneal]
    #- VM: [avast,avira,eset,fsecure]
    - INTERNET: False
    - REPORT:
        - DISPATCH
        - PUSH_VIRUS

SYSTEM_ELITE:
    #- VM: [avast,eset,avast32,avg,avg32,avira,kis,kis14,kis32,mcafee,norton,panda,comodo]
    - VM_ALL: important
    - SLEEP: [1,100]
    - CALL: INIT_DISPATCH
    - REPORT:
        - VM_ELITE
        #- VM_PUSH_VIRUS
    - CALL: END_DISPATCH

SYSTEM_ELITE_BIS:
    #- VM: [avast,eset,avast32,avg,avg32,avira,kis,kis14,kis32,mcafee,norton,panda,comodo]
    - VM_ALL: ininfluent
    - SLEEP: [1,100]
    - CALL: INIT_DISPATCH
    - REPORT:
        - VM_ELITE
        #- VM_PUSH_VIRUS
    - CALL: END_DISPATCH

SYSTEM_MANUAL_CHECK:
    - VM: [kis,360cn]
    - CALL: INIT_DISPATCH
    #- CALL: VM_PUSH_AGENT
    #- CALL: VM_SCOUT
    - START_AGENT
    - CALL: SET_DEFAULTS
    - BUILD: [ pull, windows, melt ]
    - STOP_AGENT

